<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--menu for payment Order-->
    <menuitem id="payment_order_root_menu" name="Payment Order"
              groups="account.group_account_user,slnee_security.group_service_manager,slnee_security.group_gm"
              web_icon="slnee_payment_correlation,static/description/icon.png" sequence="41"/>

    <record id="view_correlation_order_form" model="ir.ui.view">
        <field name="name">view.correlation.order.form</field>
        <field name="model">correlation.order</field>
        <field name="inherit_id" ref="slnee_correlation_order.view_correlation_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='correlation_order_line']/tree//field[@name='correlated_amount']"
                   position="after">
                <field name="consumed_amount"/>
            </xpath>
            <xpath expr="//field[@name='correlation_order_line']/form//field[@name='remaining_amount']"
                   position="before">
                <field name="consumed_amount"/>
            </xpath>
            <xpath expr="//field[@name='correlation_order_line']/form/group" position="after">
                <field name="payment_line_ids" readonly="1">
                    <tree>
                        <field name="budget_line_id"/>
                        <field name="required_amount"/>
                    </tree>

                </field>
            </xpath>

            <xpath expr="//field[@name='notes']"
                   position="after">
                <separator/>
                <label for="payment_order_ids"/>
                <field name="payment_order_ids" readonly="1"/>
            </xpath>
        </field>
    </record>

    <record id="view_account_payment_form" model="ir.ui.view">
        <field name="name">view.correlation.order.payment.form</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="replace">
                <header>
                    <button name="confirm" class="oe_highlight" states="draft" string="Confirm" type="object"/>
                    <button name="approve" class="oe_highlight" states="confirm" string="Services Manager Approval"
                            groups="slnee_security.group_service_manager" type="object"/>
                    <button name="cancel"
                            confirm="Are you sure you want to refuse, Please write down your refusal reason?"
                            class="oe_highlight" states="confirm" string="Refuse"
                            groups="slnee_security.group_service_manager" type="object"/>
                    <button name="validate" class="oe_highlight" states="approve" string="Secretary General Approval"
                            groups="slnee_security.group_gm" type="object"/>
                    <button name="cancel"
                            confirm="Are you sure you want to refuse, Please write down your refusal reason?"
                            class="oe_highlight" states="approve" string="Refuse" groups="slnee_security.group_gm"
                            type="object"/>
                    <button name="post" class="oe_highlight" states="validate" string="Transfer/Post"
                            groups="account.group_account_user" type="object"/>
                    <button name="action_draft" class="oe_highlight" states="cancelled" string="Set To Draft"
                            type="object"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirm,approve,posted,reconciled"/>
                </header>
            </xpath>
            <xpath expr="//field[@name='payment_method_code']"
                   position="after">
                <field name="using_correlation" readonly='1'
                       attrs="{'required':1,'invisible':[('payment_type', '!=','outbound')]}"/>
                <field name="correlation_order_id" options="{'no_create': True, 'no_open': True}"
                       domain="[('partner_id','=',partner_id),('is_closed','=',False)]"
                       attrs="{'required':[('using_correlation','!=','no')],'invisible':[('using_correlation','!=','yes')],'readonly': [('state', '!=', 'draft')]}"/>
            </xpath>
            <xpath expr="/form/sheet/group" position="after">
                <field name="payment_line_ids"
                       attrs="{'readonly': [('state', '!=', 'draft')],'invisible':[('using_correlation','!=','yes')]}">
                    <tree editable="bottom">
                        <field name="correlation_order_id" invisible="1"/>
                        <field name="correlation_line_id" options="{'no_create': True, 'no_open': True}"
                               domain="[('order_id','=',parent.correlation_order_id),('is_closed','=',False)]"
                               required="1"/>
                        <field name="budget_line_id" options="{'no_create': True, 'no_open': True}"/>
                        <field name="available_amount"/>
                        <field name="required_amount" required="1"/>
                    </tree>
                </field>
            </xpath>
        </field>
    </record>

    <record id="account.action_account_payments_payable" model="ir.actions.act_window">
        <field name="domain">[]</field>
    </record>

    <record id="view_account_payment_tree" model="ir.ui.view">
        <field name="name">account.supplier.payment.tree</field>
        <field name="model">account.payment</field>
        <field name="arch" type="xml">
            <tree decoration-info="state == 'draft'" decoration-muted="state in ['reconciled', 'cancelled']">
                <field name="payment_date"/>
                <field name="name"/>
                <field name="journal_id"/>
                <field name="payment_method_id"/>
                <field name="partner_id" string="Partner"/>
                <field name="amount" sum="Amount"/>
                <field name="company_id" groups="base.group_multi_company"/>
                <field name="state"/>
                <field name="currency_id" invisible="1"/>
                <field name="partner_type" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="action_account_payments" model="ir.actions.act_window">
        <field name="name">Payments Order</field>
        <field name="res_model">account.payment</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,kanban,form,graph</field>
        <field name="context">{}</field>
        <field name="domain">[]</field>
        <field name="view_id" ref="view_account_payment_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Register a payment
            </p>
            <p>
                Payments are used to register liquidity movements. You can process those payments by your own means or
                by using installed facilities.
            </p>
        </field>
    </record>

    <record id="action_account_payments_need_approve" model="ir.actions.act_window">
        <field name="name">Payments Under Approve</field>
        <field name="res_model">account.payment</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,kanban,form,graph</field>
        <field name="context">{'default_payment_type': 'outbound', 'default_partner_type': 'supplier'}</field>
        <field name="domain">[('state','in',['confirm','approve'])]</field>
        <field name="view_id" ref="view_account_payment_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Register a payment
            </p>
            <p>
                Payments are used to register liquidity movements. You can process those payments by your own means or
                by using installed facilities.
            </p>
        </field>
    </record>

    <record id="action_account_payments_approved" model="ir.actions.act_window">
        <field name="name">Payments Approved</field>
        <field name="res_model">account.payment</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,kanban,form,graph</field>
        <field name="context">{'default_payment_type': 'outbound', 'default_partner_type': 'supplier'}</field>
        <field name="domain">[('state','=','validate')]</field>
        <field name="view_id" ref="view_account_payment_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Register a payment
            </p>
            <p>
                Payments are used to register liquidity movements. You can process those payments by your own means or
                by using installed facilities.
            </p>
        </field>
    </record>

    <!--res partner form-->
    <record id="view_partner_form_inherit" model="ir.ui.view">
        <field name="name">inherit.res.partner.form</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <field name="lang" position="after">
                <field name="employee"/>
            </field>
        </field>
    </record>

    <!--hide register payment on invoice form-->
    <record id="inherit_invoice_supplier_form" model="ir.ui.view">
        <field name="name">account.invoice.supplier.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_supplier_form"/>
        <field name="arch" type="xml">
            <button name="%(account.action_account_invoice_payment)d" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
        </field>
    </record>

    <record id="inherit_invoice_form" model="ir.ui.view">
        <field name="name">account.invoice.form</field>
        <field name="model">account.invoice</field>
        <field name="inherit_id" ref="account.invoice_form"/>
        <field name="arch" type="xml">
            <button name="%(account.action_account_invoice_payment)d" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
        </field>
    </record>

    <!--menus-->
    <menuitem id="payment_order_main_submenu" name="Payment Order"
              action="action_account_payments" parent="account.menu_finance"
              groups="account.group_account_user" sequence="5"/>

    <menuitem id="payment_order_main_menu_account" name="Payment Order"
              action="action_account_payments" parent="payment_order_main_submenu" groups="account.group_account_user"
              sequence="1"/>

    <menuitem id="payment_order_need_approval_submenu" name="Payments Need Approval"
              action="action_account_payments_need_approve" parent="payment_order_main_submenu"
              groups="slnee_security.group_gm,slnee_security.group_service_manager" sequence="2"/>

    <menuitem id="payment_order_approved_submenu" name="Payments Approved"
              action="action_account_payments_approved" parent="payment_order_main_submenu"
              groups="account.group_account_user" sequence="3"/>

    <!--menus under main menu from main interface-->

    <menuitem id="payment_order_main_menu" name="Payment Order"
              action="action_account_payments" parent="payment_order_root_menu" groups="account.group_account_user"
              sequence="1"/>

    <menuitem id="payment_order_need_approval_menu" name="Payments Need Approval"
              action="action_account_payments_need_approve" parent="payment_order_root_menu"
              groups="slnee_security.group_gm,slnee_security.group_service_manager" sequence="2"/>

    <menuitem id="payment_order_approved_menu" name="Payments Approved"
              action="action_account_payments_approved" parent="payment_order_root_menu"
              groups="account.group_account_user" sequence="3"/>


</odoo>
